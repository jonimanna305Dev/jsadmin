<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>QR Attendance Scanner</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- QR Scanner -->
    <script src="https://unpkg.com/html5-qrcode"></script>

    <style>
        #reader {
            border: 3px dashed #0d6efd;
            border-radius: 12px;
            padding: 10px;
        }
        .scanned {
            background-color: #d1e7dd !important;
        }
    </style>
</head>
<body class="bg-light">

<div class="container mt-5">
    <div class="row justify-content-center">

        <div class="col-md-10 text-center">
            <h4 class="mb-3">QR Attendance Scanner</h4>

            <!-- Controls -->
            <div class="d-flex justify-content-center gap-2 mb-3">
                <select id="cameraSelect" class="form-select w-auto"></select>
                <button class="btn btn-success" onclick="startScanner()">Start</button>
                <button class="btn btn-danger" onclick="stopScanner()">Stop</button>
            </div>

            <!-- Scanner -->
            <div id="reader" class="mb-4"></div>

            <!-- Attendance Table -->
            <table class="table table-bordered table-striped mt-3">
                <thead class="table-dark">
                    <tr>
                        <th>#</th>
                        <th>Student ID</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="attendanceList">
                    <tr data-student-id="STD-1001">
                        <td>1</td>
                        <td>STD-1001</td>
                        <td class="status text-danger fw-bold">Absent</td>
                    </tr>
                    <tr data-student-id="STD-1002">
                        <td>2</td>
                        <td>STD-1002</td>
                        <td class="status text-danger fw-bold">Absent</td>
                    </tr>
                    <tr data-student-id="STD-1003">
                        <td>3</td>
                        <td>STD-1003</td>
                        <td class="status text-danger fw-bold">Absent</td>
                    </tr>
                </tbody>
            </table>
        </div>

    </div>
</div>

<!-- Beep Sound -->
<audio id="beep">
    <source src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg">
</audio>

<script>
    let html5QrCode;
    let cameraId = null;

    // Load cameras
    Html5Qrcode.getCameras().then(cameras => {
        let select = document.getElementById('cameraSelect');
        cameras.forEach(cam => {
            let option = document.createElement('option');
            option.value = cam.id;
            option.text = cam.label;
            select.appendChild(option);
        });
        if (cameras.length) cameraId = cameras[0].id;
    });

    document.getElementById('cameraSelect').addEventListener('change', function () {
        cameraId = this.value;
    });

    function startScanner() {
        html5QrCode = new Html5Qrcode("reader");

        html5QrCode.start(
            cameraId,
            { fps: 10, qrbox: { width: 250, height: 250 } },
            onScanSuccess
        );
    }

    function stopScanner() {
        if (html5QrCode) {
            html5QrCode.stop();
        }
    }

    function onScanSuccess(decodedText) {
        let rows = document.querySelectorAll('#attendanceList tr');
        let found = false;

        rows.forEach(row => {
            let studentId = row.dataset.studentId;

            if (studentId === decodedText) {
                let status = row.querySelector('.status');

                if (status.innerText === 'Present') {
                    return;
                }

                status.innerText = 'Present';
                status.classList.remove('text-danger');
                status.classList.add('text-success');
                row.classList.add('scanned');

                document.getElementById('beep').play();
                found = true;
            }
        });

        if (!found) {
            alert('Student not found!');
        }
    }
</script>

</body>
</html>
